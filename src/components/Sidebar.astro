---
import { fetchProducts } from '../utils/api';
const { siteTitle = 'HAKU' } = Astro.props;

// 取得資料以列出分類
const { products } = await fetchProducts();
const categories = [...new Set(products.map((p) => p.category).filter(Boolean))];
---

<div id="sidebar-overlay" class="overlay"></div>

<aside id="main-sidebar" class="sidebar">
  <div class="sidebar-header">
    <h1>{siteTitle}</h1>
    <button id="close-menu" class="close-btn material-symbols-outlined">close</button>
  </div>
  
  <nav class="sidebar-nav">
    <a href="/">首頁</a>
    <a href="/shop">所有選品</a>
    <div class="nav-divider"></div>
    <span class="nav-label">CATEGORIES</span>
    {categories.map(cat => (
      <a href={`/category/${cat}`}>{cat}</a>
    ))}
  </nav>
</aside>

<script>
  import { isMenuOpen } from '../store';

  const sidebar = document.getElementById('main-sidebar');
  const overlay = document.getElementById('sidebar-overlay');
  const closeBtn = document.getElementById('close-menu');

  isMenuOpen.subscribe(open => {
    if (open) {
      sidebar?.classList.add('active');
      overlay?.classList.add('active');
    } else {
      sidebar?.classList.remove('active');
      overlay?.classList.remove('active');
    }
  });

  const close = () => isMenuOpen.set(false);
  closeBtn?.addEventListener('click', close);
  overlay?.addEventListener('click', close);
</script>

<style>
  .overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); z-index: 1999;
    opacity: 0; visibility: hidden; transition: 0.3s;
  }
  .overlay.active { opacity: 1; visibility: visible; }

  .sidebar {
    position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
    background: #F5F1E8; border-right: 1px solid #3E2723;
    z-index: 2000; transition: transform 0.3s ease;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
  }
  .sidebar.active { transform: translateX(280px); }

  .sidebar-header {
    padding: 20px; border-bottom: 1px solid rgba(62,39,35,0.1);
    display: flex; justify-content: space-between; align-items: center;
  }
  .sidebar-header h1 { margin: 0; font-size: 1.5rem; font-family: 'Montserrat', sans-serif; font-weight: 900; }
  .close-btn { background: none; border: none; cursor: pointer; font-size: 1.5rem; color: #3E2723; }

  .sidebar-nav { padding: 20px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
  .sidebar-nav a { 
    text-decoration: none; color: #3E2723; font-size: 1.1rem; font-weight: 700;
    padding: 8px 0; border-bottom: 1px solid transparent;
  }
  .sidebar-nav a:hover { border-bottom-color: #3E2723; }
  
  .nav-divider { height: 1px; background: rgba(62,39,35,0.1); margin: 10px 0; }
  .nav-label { font-size: 0.8rem; opacity: 0.5; font-family: 'Montserrat', sans-serif; letter-spacing: 1px; margin-bottom: 5px; }
</style>
