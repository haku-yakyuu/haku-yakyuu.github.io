---
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getHakuData } from '../../utils/api';

export async function getStaticPaths() {
  const { products } = await getHakuData();
  const uniqueCategories = [...new Set(products.map(p => p.category))];

  return uniqueCategories.map(cat => {
    return {
      params: { slug: cat },
      props: { categoryName: cat },
    };
  });
}

const { categoryName } = Astro.props;
const { products, config, solidTagsList } = await getHakuData();

const categoryProducts = products.filter(p => p.category === categoryName);
---

<Layout title={categoryName} siteTitle={config.site_title}>
    <header class="cat-header">
        <h1>{categoryName}</h1>
        <span>/ {categoryProducts.length} ITEMS</span>
    </header>
    
    <div class="p-grid grid-mixed">
        {categoryProducts.map(product => (
            <ProductCard 
                product={product} 
                solidTagsList={solidTagsList} 
            />
        ))}
    </div>
</Layout>

<style>
    .cat-header {
        margin-bottom: 40px;
        display: flex;
        align-items: baseline;
        gap: 15px;
        border-bottom: 2px solid var(--haku-ink);
        padding-bottom: 10px;
    }
    .cat-header h1 { margin: 0; font-size: 2rem; font-weight: 900; }
    .cat-header span { font-weight: bold; opacity: 0.7; }

    .p-grid { display: grid; gap: 20px; width: 100%; }
    .grid-mixed { grid-template-columns: 1fr; }
    @media (min-width: 768px) {
        .grid-mixed { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
    }
</style>
