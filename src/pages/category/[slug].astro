---
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getProducts } from '../../utils/api';

export async function getStaticPaths() {
  const products = await getProducts();
  const uniqueCategories = [...new Set(products.map(p => p.category))];

  return uniqueCategories.map(cat => {
    const filteredProducts = products.filter(p => p.category === cat);
    return {
      params: { slug: cat },
      props: { categoryName: cat, products: filteredProducts },
    };
  });
}

const { categoryName, products } = Astro.props;
---

<Layout title={categoryName}>
    <div class="page-header">
        <h1>{categoryName}</h1>
        <span class="count">共 {products.length} 項商品</span>
    </div>
    <div class="grid">
        {products.map(product => (
            <ProductCard product={product} />
        ))}
    </div>
</Layout>

<style>
    .page-header { display: flex; align-items: baseline; margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .page-header h1 { margin: 0; margin-right: 15px; }
    .count { color: #888; font-size: 0.9rem; }
</style>
