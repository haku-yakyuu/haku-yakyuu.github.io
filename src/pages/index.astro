---
import Layout from '../layouts/Layout.astro';
import ProductCard from '../components/ProductCard.astro';
import { getHakuData } from '../utils/api';

const { products, config, solidTagsList } = await getHakuData();

// --- 資料分組邏輯 ---
// 1. 直式卡片 (Grid Vertical)
// 包含: isFeatured=true 的商品，以及 layout='vertical' 的商品
const verticalItems = products.filter(p => p.layout === 'vertical');
const featuredItems = verticalItems.filter(p => p.isFeatured).slice(0, 4);
const otherVerticals = verticalItems.filter(p => !p.isFeatured);

// 2. 橫式有圖 (Grid Horizontal Img)
const horizontalImgItems = products.filter(p => p.layout === 'horizontal');

// 3. 橫式無圖 (Grid Horizontal No-Img)
const horizontalNoImgItems = products.filter(p => p.layout === 'no_image');
---

<Layout title="Home" siteTitle={config.site_title}>

    <!-- Hero Section -->
    <header class="hero">
        <h1>{config.site_title || "CAPTURE THE MOMENT"}</h1>
        <p>從球場的紅土到收藏盒的溫度。HAKU 為您挑選每一顆承載歷史與紀錄的棒球。</p>
        <a href="/category/紀念球" class="hero-btn">探索選品</a>
    </header>

    <div class="container">
        
        {/* --- 區塊 1: 精選 (直式 - PC 4欄) --- */}
        {featuredItems.length > 0 && (
            <section>
                <div class="sec-header">
                    <h2>FEATURED ARRIVALS</h2>
                    <a href="/category/紀念球" style="font-size: 0.8rem; font-weight: 700;">VIEW ALL →</a>
                </div>
                <div class="p-grid grid-vertical">
                    {featuredItems.map(p => (
                        <ProductCard product={p} solidTagsList={solidTagsList} />
                    ))}
                </div>
            </section>
        )}

        {/* --- 區塊 2: 職人/配件 (橫式有圖 - PC 3欄) --- */}
        {horizontalImgItems.length > 0 && (
            <section>
                <div class="sec-header">
                    <h2>COLLECTOR'S ESSENTIALS</h2>
                </div>
                <div class="p-grid grid-horizontal-img">
                    {horizontalImgItems.map(p => (
                        <ProductCard product={p} solidTagsList={solidTagsList} />
                    ))}
                </div>
            </section>
        )}

        {/* --- 區塊 3: 服務 (橫式無圖 - PC 4欄) --- */}
        {horizontalNoImgItems.length > 0 && (
            <section>
                <div class="sec-header">
                    <h2>SERVICES</h2>
                </div>
                <div class="p-grid grid-horizontal-noimg">
                    {horizontalNoImgItems.map(p => (
                        <ProductCard product={p} solidTagsList={solidTagsList} />
                    ))}
                </div>
            </section>
        )}

        {/* --- 區塊 4: 其他直式商品 (若有) --- */}
        {otherVerticals.length > 0 && (
            <section>
                <div class="sec-header">
                    <h2>MORE COLLECTIONS</h2>
                </div>
                <div class="p-grid grid-vertical">
                    {otherVerticals.map(p => (
                        <ProductCard product={p} solidTagsList={solidTagsList} />
                    ))}
                </div>
            </section>
        )}

        {/* 除錯：若無任何資料 */}
        {products.length === 0 && (
             <div style="text-align:center; padding: 100px 0; opacity: 0.5;">
                <p>無商品資料，請檢查 Google Sheets 設定。</p>
            </div>
        )}

    </div>
</Layout>

<style>
    /* Hero Styles */
    .hero {
        height: 70vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
        text-align: center; background-color: var(--haku-ink); color: var(--haku-paper);
        padding: 0 10%; margin-bottom: var(--section-gap);
    }
    .hero h1 { font-family: 'Montserrat', sans-serif; font-size: 3.5rem; margin: 0; line-height: 1; }
    .hero p { max-width: 600px; margin: 20px 0; font-size: 1.1rem; opacity: 0.8; }
    .hero-btn { 
        border: 2px solid var(--haku-paper); padding: 12px 40px; 
        font-weight: 700; transition: 0.3s; margin-top: 20px; color: var(--haku-paper);
    }
    .hero-btn:hover { background: var(--haku-paper); color: var(--haku-ink); }

    @media (max-width: 768px) { .hero h1 { font-size: 2.5rem; } }
</style>
