---
import Layout from '../layouts/Layout.astro';
import ProductCard from '../components/ProductCard.astro';
import { fetchProducts } from '../utils/api';

const { products, config, error } = await fetchProducts();

// 篩選精選商品
const featuredProducts = products.filter((p) => 
  p.status === 'active' && (p.isFeatured === true || p.isFeatured === "true")
);

// 分組
const grouped = featuredProducts.reduce((acc, p) => {
  const cat = p.category || "其他";
  if (!acc[cat]) acc[cat] = [];
  acc[cat].push(p);
  return acc;
}, {});
const categories = Object.keys(grouped);
---

<Layout title="HAKU YAKYUU | 首頁">
  
  <header style="text-align:center; padding: 60px 20px; background:#3E2723; color:#F5F1E8;">
    <h1 style="margin:0; font-size: 3rem;">HAKU</h1>
    <p style="opacity:0.8;">職人眼光的棒球選品</p>
  </header>

  <main class="container">
    {error && <p style="text-align:center; padding:40px;">資料載入異常</p>}
    
    {categories.map(cat => (
      <section style="margin-top: 60px;">
        <h2 style="border-bottom: 2px solid #3E2723; padding-bottom:10px; margin-bottom: 30px;">{cat}</h2>
        <div class="grid-v">
          {grouped[cat].map((p) => <ProductCard product={p} config={config || {}} />)}
        </div>
      </section>
    ))}
  </main>

</Layout>

<style>
  .container { max-width: 1400px; margin: 0 auto; padding: 0 5%; }
  .grid-v { display: grid; gap: 20px; grid-template-columns: repeat(2, 1fr); }
  @media (min-width: 1024px) { .grid-v { grid-template-columns: repeat(4, 1fr); gap: 30px; } }
</style>
