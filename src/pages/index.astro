---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import ProductCard from '../components/ProductCard.astro';
import { getProducts } from '../utils/api';

const allProducts = await getProducts();

// 篩選出精選商品
const featuredProducts = allProducts.filter(p => p.isFeatured);

// 取得所有分類名稱
const categories = [...new Set(allProducts.map(p => p.category))];
---

<Layout title="首頁">
    
    <section class="section-featured">
        <h2 class="section-title">✨ 本月精選</h2>
        <div class="grid">
            {featuredProducts.map(product => (
                <ProductCard product={product} />
            ))}
        </div>
    </section>

    <hr class="divider">

    {categories.map(catName => {
        // 取該分類前 4 筆
        const catProducts = allProducts
            .filter(p => p.category === catName)
            .slice(0, 4);
        
        if (catProducts.length === 0) return null;

        return (
            <section class="section-category">
                <div class="category-header">
                    <h2 class="section-title">{catName}</h2>
                    <a href={`/category/${catName}`} class="view-all">查看全部 &rarr;</a>
                </div>
                <div class="grid">
                    {catProducts.map(product => (
                        <ProductCard product={product} />
                    ))}
                </div>
            </section>
        );
    })}
</Layout>

<style>
    .section-title {
        border-left: 5px solid #d4a373;
        padding-left: 15px;
        margin-bottom: 20px;
    }

    .divider {
        border: 0;
        border-top: 1px solid #eee;
        margin: 40px 0;
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .view-all {
        font-size: 0.9rem;
        color: #888;
        padding: 5px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .view-all:hover {
        border-color: #d4a373;
        color: #d4a373;
    }
</style>
