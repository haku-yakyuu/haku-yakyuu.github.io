let f=[],a=0;const c=4,y=e=>{let i=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(n){return t.lc=i.push(n),()=>{for(let l=a+c;l<f.length;)f[l]===n?f.splice(l,c):l+=c;let s=i.indexOf(n);~s&&(i.splice(s,1),--t.lc||t.off())}},notify(n,s){let l=!f.length;for(let r of i)f.push(r,t.value,n,s);if(l){for(a=0;a<f.length;a+=c)f[a](f[a+1],f[a+2],f[a+3]);f.length=0}},off(){},set(n){let s=t.value;s!==n&&(t.value=n,t.notify(s))},subscribe(n){let s=t.listen(n);return n(t.value),s},value:e};return t},O=5,v=6,g=10;let m=(e,i,t,n)=>(e.events=e.events||{},e.events[t+g]||(e.events[t+g]=n(s=>{e.events[t].reduceRight((l,r)=>(r(l),l),{shared:{},...s})})),e.events[t]=e.events[t]||[],e.events[t].push(i),()=>{let s=e.events[t],l=s.indexOf(i);s.splice(l,1),s.length||(delete e.events[t],e.events[t+g](),delete e.events[t+g])}),T=1e3,I=(e,i)=>m(e,n=>{let s=i(n);s&&e.events[v].push(s)},O,n=>{let s=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...r));let l=e.off;return e.events[v]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[v])r();e.events[v]=[]}},T)},()=>{e.listen=s,e.off=l}}),L=e=>e,o={},h={addEventListener(){},removeEventListener(){}};function x(){try{return typeof localStorage<"u"}catch{return!1}}x()&&(o=localStorage);let N={addEventListener(e,i,t){window.addEventListener("storage",i),window.addEventListener("pageshow",t)},removeEventListener(e,i,t){window.removeEventListener("storage",i),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(h=N);function M(e,i=void 0,t={}){let n=t.encode||L,s=t.decode||L,l=y(i),r=l.set;l.set=d=>{let w=n(d);typeof w>"u"?delete o[e]:o[e]=w,r(d)};function p(d){d.key===e?d.newValue===null?r(i):r(s(d.newValue)):o[e]||r(i)}function E(){l.set(o[e]?s(o[e]):i)}return I(l,()=>{if(E(),t.listen!==!1)return h.addEventListener(e,p,E),()=>{h.removeEventListener(e,p,E)}}),l}const S=y(!1),U=y(!1),u=M("haku-cart",[],{encode:JSON.stringify,decode:JSON.parse});function _(e){const i=u.get();if(i.find(n=>n.id===e.id))u.set(i.map(n=>n.id===e.id?{...n,quantity:n.quantity+1}:n));else{const n=e.layout&&e.layout.startsWith("/")?e.layout:e.layout==="no_image"?"no_image":`/products/${e.id}-0.jpg`;u.set([...i,{id:e.id,name:e.name,price:e.price,image:n,quantity:1}])}S.set(!0)}function q(e){u.set(u.get().filter(i=>i.id!==e))}function R(e,i){const t=u.get();u.set(t.map(n=>{if(n.id===e){const s=i==="inc"?n.quantity+1:n.quantity-1;return{...n,quantity:Math.max(1,s)}}return n}))}export{_ as a,U as b,u as c,S as i,q as r,R as u};
